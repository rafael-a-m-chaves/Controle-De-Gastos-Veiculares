{% extends 'base/base.html' %}

{% block content %}   
{% load static %}
    <div class="base">
    
        <div id="coluna15e" class="coluna15">
        
        </div>
       
        <div id="coluna70" class="coluna70">

            <div id="adicionarVeiculo">
    
                <form action="" id="formAddVeiculo" method="POST">
                    
                    <div id="divTipoDeVeiculo">

                        <select name="tipoDeVeiculo" id="tipoDeVeiculo" class="selectbox" 
                        onchange="tipodeVeiculo(this)">
                        
                            <option selected value="0">Selecione o Tipo de veiculo</option>
                            <option value="1">Carro</option>
                            <option value="2">Moto</option>
                            <option value="3">Caminh√£o</option>
                            <option value="4">Conjuto Cavalo + Carreta</option>
                        
                        </select>
                    
                    </div>

                    <div id="divMarcaVeiculo"></div>
                    <div id="divModeloVeiculo"></div>

                    <div id="divMarcaMoto"></div>
                    <div id="divModeloMoto"></div>

                    <div id="divMarcaCaminhao"></div>
                    <div id="divModeloCaminhao"></div>

                    <div id="divMarcaConjunto"></div>
                    <div id="divModeloConjunto"></div>

                </form>
    
            </div> 

        </div>

        <div id="coluna15d" class="coluna15">

        </div>
    
    </div>

<script>
    function tipodeVeiculo(valor){
        var veiculo = document.getElementById('divMarcaVeiculo');
        var moto = document.getElementById('divMarcaMoto');
        var caminhao = document.getElementById('divMarcaCaminhao');
        var conjunto = document.getElementById('divMarcaConjunto');

        if (valor.value==='0'){
            $(veiculo).hide();
            $(moto).hide();
            $(caminhao).hide();
            $(conjunto).hide();
        
        }else if(valor.value==="1"){
            $(veiculo).show();
            $(moto).hide();
            $(caminhao).hide();
            $(conjunto).hide();
            if( $(veiculo).is(':empty') ) {
                urld = "{% static 'csv/veiculos/baseDeDados/marcas-carros.csv' %}";
                divd = "divMarcaVeiculo";
                selectMontadoraVeiculo(urld,divd);
            }
        
        }else if(valor.value==="2"){
            $(veiculo).hide();
            $(moto).show();
            $(caminhao).hide();
            $(conjunto).hide();
            if( $(moto).is(':empty') ) {
                urld = "{% static 'csv/veiculos/baseDeDados/marcas-motos.csv' %}";
                divd = "divMarcaMoto";
                selectMontadoraVeiculo(urld,divd);
            }
        
        }else if(valor.value==="3"){
            $(veiculo).hide();
            $(moto).hide();
            $(caminhao).show();
            $(conjunto).hide();
            if( $(caminhao).is(':empty') ) {
                urld = "{% static 'csv/veiculos/baseDeDados/marcas-caminhao.csv' %}";
                divd = "divMarcaCaminhao";
                selectMontadoraVeiculo(urld,divd);
            }
        
        }else if(valor.value==="4"){
            $(veiculo).hide();
            $(moto).hide();
            $(caminhao).hide();
            $(conjunto).show();
            if( $(conjunto).is(':empty') ) {
                urld = "{% static 'csv/veiculos/baseDeDados/marcas-caminhao.csv' %}";
                divd = "divMarcaConjunto";
                selectMontadoraVeiculo(urld,divd);
            }
        }
    }

    function divMarcaVeiculo(val){
        urld = "{% static 'csv/veiculos/baseDeDados/modelos-carro.csv' %}";
        divd = "divModeloVeiculo";
        marca = val.value;
        selecioneModeloVeiculo(urld,divd,marca)
    }

    function selectMontadoraVeiculo(urld,divd){
        $.ajax({
            url: urld,
            dataType: 'text',
        }).done(successFunction);

        function successFunction(data) {
            var allRows = data.split(/\r?\n|\r/);
            var select = "<select id='selectMarca' name='selectMarca' class='selectbox' onchange='"+divd+"(this)'>"
            var divMarcaVeiculo = document.getElementById(divd);
            
            for (var singleRow = 0; singleRow < allRows.length; singleRow++) {
            var rowCells = allRows[singleRow].split(';');
            var cont = 0;

            for (var rowCell = 0; rowCell < rowCells.length; rowCell++) {
                if (singleRow ===0){
                    if(cont===0){
                        select += ('<option value=selecione>Selecione uma Marca</option>');
                        cont += 1;
                    }
                }
                
                else if (rowCell === 0){
                    select += ('<option value='+rowCells[rowCell]+'>');
                
                }else{
                    select += (rowCells[rowCell]+'</option>');
                }

            }
            
            } 
            select += '</select>';
            $(divMarcaVeiculo).append(select);
        }
    }


    function selecioneModeloVeiculo(urld,divd,marca){
        $.ajax({
            url: urld,
            dataType: 'text',
        }).done(successFunction);

        function successFunction(data) {
            var allRows = data.split(/\r?\n|\r/);
            var select = "<select id='selectModelo' name='selectModelo' class='selectbox'>"
            var divMarcaVeiculo = document.getElementById(divd);
            
            for (var singleRow = 0; singleRow < allRows.length; singleRow++) {
            var rowCells = allRows[singleRow].split(';');
            var cont = 0;

            
                if (singleRow ===0){
                    if(cont===0){
                        select += ('<option value=selecione>Selecione um Modelo</option>');
                        cont += 1;
                        alert(rowCells[1],parseInt(marca));
                    }
                }else if (rowCells[1] === parseInt(marca)){
                    alert(rowCells[1],parseInt(marca));
                    select += ('<option value='+rowCells[0]+'>');
                    select += (rowCells[2]+'</option>')
                
                }

            
            
            } 
            select += '</select>';
            $(divMarcaVeiculo).append(select);
        }
    }

    function teste(){
        alert('deu certo')
    }
</script>
    
{% endblock %}
